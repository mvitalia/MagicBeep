<!DOCTYPE html>
<html>

<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, user-scalable=no,
		shrink-to-fit=no, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0" />

	<title>Magic Beep</title>

	<style>
		@import '../ui/css/evothings-app.css';
	</style>
     <link rel="stylesheet" type="text/css" href="../css/jquery.mobile-1.4.5.min.css"/>
     <link rel="stylesheet" type="text/css" href="../css/jquery.mobile.icons.min.css"/>
       <!-- Fonts -->
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,300,700' rel='stylesheet' type='text/css'>
    <!-- Icons -->
    <link href="../css/ionicons.min.css" media="all" rel="stylesheet" type="text/css">
    <!-- Styles -->
    <link href="../css/keyframes.css" rel="stylesheet" type="text/css">
    <link href="../css/materialize.min.css" rel="stylesheet" type="text/css">
    <link href="../css/swiper.css" rel="stylesheet" type="text/css">
    <link href="../css/swipebox.min.css" rel="stylesheet" type="text/css">
    <link href="../css/style.css" rel="stylesheet" type="text/css">
     <link href="../css/custom.css" rel="stylesheet" type="text/css">
	<script>
	// Redirect console.log to Evothings Workbench.
	if (window.hyper && window.hyper.log) { console.log = hyper.log }
	</script>
	<script src="../libs/jquery/jquery.js"></script>
     <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&sensor=false"></script>
	<script type="text/javascript" src="../js/jquery.mobile-1.4.5.min.js"></script>
	<script src="../libs/evothings/evothings.js"></script>
	<script src="../libs/evothings/ui/ui.js"></script>

</head>

<body>
<script>
// Inizio mappa
 $(document).on("pagebeforeshow", "#mappe", function () {
  GMap.init();
});

/* Style of the map */
		 var styles = [
		 {
			stylers: [
			  //{ "hue": "#f0f0f0" }
	
			]
		 }
		 ,{
			  "featureType": "water",
			  "stylers": [
				 { "hue": "#90B8FD" },
				 { "lightness": 0 },
				 { "visibility": "on" }
			  ]
			}
  
 
  
			
		 ,{
			  "featureType": "landscape",
			  "stylers": [
				 { "color": "#F0F0F0" },
				
			  ]
			}
		  ,{ 
		 "featureType": "administrative.country",
		 "elementType": "geometry",
		 "stylers": [
			{ "color": "#777777" },
			{ "weight": 1 }
		 
		 ]
		  }
		 ,{
			  "featureType": "administrative.country",
			  "elementType": "labels.text",
			  "stylers": [
				 { "visibility": "simplified" }
				 //{ "color": "#333333" }
			  ]
			},
		 
		 {
			featureType: "road",
			elementType: "geometry",
			stylers: [
			  { lightness: 100 },
			  { visibility: "simplified" }
			]
		 },{
			featureType: "road",
			elementType: "labels",
			stylers: [
			  { visibility: "off" }
			]
		 },{
				featureType: "poi",
				elementType: "labels",
				stylers: [
				  { visibility: "off" }
				]
			 }
	 
	
		  ];

var GMap = {
map: null,
infoWindow: null
};

GMap.closeInfoWindow = function() {
GMap.infoWindow.close();
};

GMap.openInfoWindow = function(marker, testo) {
var markerLatLng = marker.getPosition();
GMap.infoWindow.setContent(testo);
GMap.infoWindow.open(GMap.map, marker);
},

GMap.init = function() {
var centerLatLng = new google.maps.LatLng(45.0199796,7.6471059);
var styledMap = new google.maps.StyledMapType(styles, {name: "titolo"});

var mapOptions = {
zoom: 11, 				//zoom level
center: centerLatLng, 		//center position
scrollwheel: false, 	//zoom when scroll disable
zoomControl: true, 		//show control zoom

mapTypeControlOptions: {
mapTypeIds: [google.maps.MapTypeId.ROADMAP, 'map_style'] 
}

};

GMap.map = new google.maps.Map(document.getElementById('map_canvas'),mapOptions);
GMap.infoWindow = new google.maps.InfoWindow();

//Associate the styled map with the MapTypeId and set it to display.
GMap.map.mapTypes.set('map_style', styledMap);
GMap.map.setMapTypeId('map_style');
google.maps.event.addListener(GMap.map, 'click', GMap.closeInfoWindow);

<!---loop dei progetti della zona --->
  
var image = 'img/marker.png';
  $.getJSON("http://magicbeep.mvclienti.com/webservices/sync_negozi.aspx", function (dati) {
                  
                    $.each(dati, function (i, name) {
                     alert("ok");
                          marker = new google.maps.Marker({
                          map: GMap.map,
                          position: new google.maps.LatLng(name.latitudine, name.longitudine),
                          draggable: true,
                          icon: image
                          });
                          google.maps.event.addListener(marker, 'click', function() {
                          GMap.openInfoWindow(marker, '<strong>titolo</strong><br/><br/><a href="#" target="_blank">raggiungici</a>');
                          });
                    });
					  // Funzione per la selezione dei beacon da ricercare dal db dell' app
                             
});
/*
var marker = new google.maps.Marker({
map: GMap.map,
position: new google.maps.LatLng(45.02045, 7.66473),
draggable: true,
icon: image
});

google.maps.event.addListener(marker, 'click', function() {
GMap.openInfoWindow(marker, '<strong>titolo</strong><br/><br/><a href="#" target="_blank">raggiungici</a>');
});

var marker2 = new google.maps.Marker({
map: GMap.map,
position: new google.maps.LatLng(44.9177489, 8.1323169),
draggable: true,
icon: image
});

google.maps.event.addListener(marker2, 'click', function() {
GMap.openInfoWindow(marker2, '<strong>titolo</strong><br/><br/><a href="#" target="_blank">raggiungici</a>');
});
*/
}

// Fine mappa 
</script> 
<script src="../app.js"></script>
<script type="text/javascript" src="../js/dati.js"></script>
<script src="../js/jquery.swipebox.min.js"></script>   
<script src="../js/materialize.min.js"></script> 
<script src="../js/swiper.min.js"></script>  
<script src="../js/jquery.mixitup.min.js"></script>
<script src="../js/masonry.min.js"></script>
<script src="../js/chart.min.js"></script>
<script src="../js/functions.js"></script>

</body>

</html>
